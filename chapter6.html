

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>6 Nested, Hierarchical, Multilevel, Longitudinal Data &#8212; Stata Programming</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" href="_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script src="_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'chapter6';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="7. Visualizing data in Stata" href="chapter7.html" />
    <link rel="prev" title="5. Review of Weeks 1 - 4" href="chapter5.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="intro.html">
  
  
  
  
    
    
      
    
    
    <img src="https://brand.jhu.edu/assets/uploads/sites/5/2014/06/university_logo_small_vertical_blue.png" class="logo__image only-light" alt="Logo image"/>
    <script>document.write(`<img src="https://brand.jhu.edu/assets/uploads/sites/5/2014/06/university_logo_small_vertical_blue.png" class="logo__image only-dark" alt="Logo image"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="intro.html">
                    Preface
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="chapter1.html">1. Philosophy, overview, commands, syntax</a></li>
<li class="toctree-l1"><a class="reference internal" href="chapter2.html">2. Return values, macros, programs</a></li>
<li class="toctree-l1"><a class="reference internal" href="chapter3.html">3. Loops, Program Syntax, and Miscellany</a></li>
<li class="toctree-l1"><a class="reference internal" href="chapter4.html">4. Basic file management, Programming options</a></li>
<li class="toctree-l1"><a class="reference internal" href="chapter5.html">5. Review of Weeks 1 - 4</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">6 Nested, Hierarchical, Multilevel, Longitudinal Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="chapter7.html">7. Visualizing data in Stata</a></li>
<li class="toctree-l1"><a class="reference internal" href="chapter8.html">8.Survival Analysis: Non-parametric, Semi-parametric, Parametric</a></li>
<li class="toctree-l1"><a class="reference internal" href="quickrefs.html">Quick References</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/executablebooks/jupyter-book" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/executablebooks/jupyter-book/issues/new?title=Issue%20on%20page%20%2Fchapter6.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/chapter6.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>6 Nested, Hierarchical, Multilevel, Longitudinal Data</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#introduction-to-debugging">Introduction to Debugging</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#revisiting-hardcoding">Revisiting Hardcoding</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#understanding-isid">6.1 Understanding <code class="docutils literal notranslate"><span class="pre">isid</span></code></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#independently-and-identically-distributed-data-i-i-d">Independently and Identically Distributed Data (i.i.d.)</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-concept-of-collapse">6.2 The Concept of <code class="docutils literal notranslate"><span class="pre">collapse</span></code></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#use-of-egen">6.3 Use of <code class="docutils literal notranslate"><span class="pre">egen</span></code></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#data-integrity-with-preserve-and-restore">6.4 Data Integrity with <code class="docutils literal notranslate"><span class="pre">preserve</span></code> and <code class="docutils literal notranslate"><span class="pre">restore</span></code></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#combining-data-with-merge">6.5 Combining Data with <code class="docutils literal notranslate"><span class="pre">merge</span></code></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#flexible-data-structures-with-reshape">6.6 Flexible Data Structures with <code class="docutils literal notranslate"><span class="pre">reshape</span></code></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#other">6.7 Other</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#lab-session">6.8 Lab Session</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#homework">6.9 Homework</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="nested-hierarchical-multilevel-longitudinal-data">
<h1>6 Nested, Hierarchical, Multilevel, Longitudinal Data<a class="headerlink" href="#nested-hierarchical-multilevel-longitudinal-data" title="Permalink to this heading">#</a></h1>
<div class="highlight-stata notranslate"><div class="highlight"><pre><span></span><span class="k">global</span> repo https:<span class="o">//</span>github<span class="m">.</span>com<span class="o">/</span>jhustata<span class="o">/</span>basic<span class="o">/</span>raw<span class="o">/</span>main<span class="o">/</span>
</pre></div>
</div>
<section id="introduction-to-debugging">
<h2>Introduction to Debugging<a class="headerlink" href="#introduction-to-debugging" title="Permalink to this heading">#</a></h2>
<details>
<summary>Click to expand!</summary>
<p>Before diving into nested data, let’s revisit the concept of debugging with a simple example from Lab 5 last week.</p>
<p>There’s no perfect time to introduce this topic, but many of you have likely experienced the frustration of encountering an error when running a script—whether it’s your own or one shared with you—and not being able to pinpoint the issue. Understanding debugging early on will aid in handling complex data structures more efficiently.</p>
<p>Refer to the detailed debugging steps here: <a class="reference external" href="https://jhustata.github.io/basic/lab5.html#settings">Lab 5 Part I Section 1: Settings</a> - Click on the token!</p>
</details>
</section>
<section id="revisiting-hardcoding">
<h2>Revisiting Hardcoding<a class="headerlink" href="#revisiting-hardcoding" title="Permalink to this heading">#</a></h2>
<details>
<summary>Click to expand!</summary>
<p>Last week, we reviewed the basics from Weeks 1 to 4. Let’s look at the script we used and discuss how it can be adapted for different outputs, moving from <code class="docutils literal notranslate"><span class="pre">.log</span></code> files to <code class="docutils literal notranslate"><span class="pre">.xlsx</span></code> files, something you’ve all grappled with over the last few days in answering your HW5.</p>
<p>Review the script here: <a class="reference external" href="https://jhustata.github.io/basic/chapter5.html">Week 5 Review</a></p>
<div class="highlight-stata notranslate"><div class="highlight"><pre><span></span><span class="k">cat</span> <span class="vg">${repo}</span>review<span class="m">.</span>do
<span class="k">do</span> <span class="vg">${repo}</span>review<span class="m">.</span>do
</pre></div>
</div>
<p><a class="reference internal" href="hardcoding.html"><span class="doc std std-doc">Hardcoding</span></a> can be a useful starting point, but it’s essential to evolve your scripts to be dynamic and adaptable to different datasets and requirements. This involves using macros and avoiding fixed variable names or parameters wherever possible.</p>
<p>Example adaptations for homework and further discussion are included in the HW5 solution (click <strong>here</strong> after 11:59PM of May 03, 2024), which emphasizes replacing hardcoded components with flexible code suited for publication-quality outputs.</p>
</details>
</section>
<section id="understanding-isid">
<h2>6.1 Understanding <code class="docutils literal notranslate"><span class="pre">isid</span></code><a class="headerlink" href="#understanding-isid" title="Permalink to this heading">#</a></h2>
<p>Moving away from <code class="docutils literal notranslate"><span class="pre">levelsof</span></code>, we focus on understanding how data is structured within datasets. This week’s themes revolve around different levels of data:</p>
<ul class="simple">
<li><p>Visits</p></li>
<li><p>Patient</p></li>
<li><p>Hospital</p></li>
<li><p>Region</p></li>
</ul>
<p>The <code class="docutils literal notranslate"><span class="pre">isid</span></code> command is crucial for ensuring data integrity and understanding the unique identifiers across these levels.</p>
<section id="independently-and-identically-distributed-data-i-i-d">
<h3>Independently and Identically Distributed Data (i.i.d.)<a class="headerlink" href="#independently-and-identically-distributed-data-i-i-d" title="Permalink to this heading">#</a></h3>
<p>Classical statistics often assumes each observation is independently and identically distributed (i.i.d.). However, nested and multilevel data often violate this assumption, necessitating different analytical approaches.</p>
<p>Explore the <code class="docutils literal notranslate"><span class="pre">i.i.d.</span></code> assumption in detail here: <a class="reference external" href="https://en.wikipedia.org/wiki/Independent_and_identically_distributed_random_variables">i.i.d. in Statistics</a></p>
</section>
</section>
<section id="the-concept-of-collapse">
<h2>6.2 The Concept of <code class="docutils literal notranslate"><span class="pre">collapse</span></code><a class="headerlink" href="#the-concept-of-collapse" title="Permalink to this heading">#</a></h2>
<p>When you describe aggregates like the average age or median blood pressure, you’re reducing the dimensionality of your data. This simplification, while useful, can sometimes obscure the nuances of individual data points or subgroups.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">collapse</span></code> command in Stata helps in reducing data dimensions to essential summaries, but it’s crucial to be aware of the biases this might introduce, especially in hierarchical data settings. (Note: the <code class="docutils literal notranslate"><span class="pre">expand</span></code> command <a class="reference external" href="https://jhustata.github.io/basic/chapter3.html?highlight=expand#expand">does something</a> that is almost the opposite, but its really a case of “resampling” of the same rather than an expansion of horizons to appreciate nuances and variances in real-world data). See week 3 <a class="reference external" href="https://jhustata.github.io/basic/chapter3.html?highlight=collapse#collapse">Section 3.3</a> for an example:</p>
<div class="highlight-stata notranslate"><div class="highlight"><pre><span></span><span class="k">use</span> <span class="s">&quot;</span><span class="vg">${repo}</span><span class="s">transplants&quot;</span>,<span class="k"> clear</span>
<span class="k">describe</span> ctr_id
<span class="k">tab</span> ctr_id,<span class="k"> sum</span>(age)
<span class="c1">//</span>
<span class="k">collapse</span> (mean) age,<span class="k"> by</span>(ctr_id)
<span class="k">list</span>, clean
<span class="c1">//</span>
<span class="k">use</span> transplants,<span class="k"> clear</span>
<span class="k">collapse</span> (mean) age wait bmi,<span class="k"> by</span>(ctr_id)
<span class="k">list</span>, clean noobs
</pre></div>
</div>
</section>
<section id="use-of-egen">
<h2>6.3 Use of <code class="docutils literal notranslate"><span class="pre">egen</span></code><a class="headerlink" href="#use-of-egen" title="Permalink to this heading">#</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">egen</span></code> command is incredibly powerful for creating complex summaries and transformations across grouped data. We’ll explore several practical examples of <code class="docutils literal notranslate"><span class="pre">egen</span></code> to handle multilevel data efficiently. See week 3 <a class="reference external" href="https://jhustata.github.io/basic/chapter3.html?highlight=egen">Section 3.3</a> for an example:</p>
<div class="highlight-stata notranslate"><div class="highlight"><pre><span></span><span class="k">bys</span> abo:<span class="k"> egen</span> age_byabo =<span class="k"> mean</span>(age)
<span class="k">codebook</span> age_byabo
</pre></div>
</div>
</section>
<section id="data-integrity-with-preserve-and-restore">
<h2>6.4 Data Integrity with <code class="docutils literal notranslate"><span class="pre">preserve</span></code> and <code class="docutils literal notranslate"><span class="pre">restore</span></code><a class="headerlink" href="#data-integrity-with-preserve-and-restore" title="Permalink to this heading">#</a></h2>
<p>Understanding how to safely manipulate datasets without losing original data is critical. The <code class="docutils literal notranslate"><span class="pre">preserve</span></code> and <code class="docutils literal notranslate"><span class="pre">restore</span></code> commands allow for temporary changes to the data, ensuring that the original structure and content are not permanently altered. See week 3 <a class="reference external" href="https://jhustata.github.io/basic/chapter3.html?highlight=preserve#preserve-restore">Section 3.3</a> for an example:</p>
<div class="highlight-stata notranslate"><div class="highlight"><pre><span></span><span class="k">use</span> <span class="vg">${repo}</span>transplants,<span class="k"> replace</span> 
<span class="c1">//preserve &amp; restore</span>
<span class="k">sum</span> age
<span class="c1">//indentation!</span>
<span class="k">preserve</span>
<span class="k">    drop if</span> age<span class="o">&lt;</span><span class="nf">r</span>(mean)
<span class="k">    sum</span> age
<span class="k">restore</span> 
<span class="k">sum</span> age
<span class="k">di</span> <span class="nf">c</span>(N)
<span class="k">di</span> <span class="nf">c</span>(k)
</pre></div>
</div>
</section>
<section id="combining-data-with-merge">
<h2>6.5 Combining Data with <code class="docutils literal notranslate"><span class="pre">merge</span></code><a class="headerlink" href="#combining-data-with-merge" title="Permalink to this heading">#</a></h2>
<p>Merging datasets is a common task in data analysis (see week 4 <a class="reference external" href="https://jhustata.github.io/basic/chapter4.html#merging-files">Section 4.2</a>), especially when dealing with longitudinal or multilevel data. We will cover best practices and common pitfalls in merging datasets from different sources or time points.</p>
<div class="highlight-stata notranslate"><div class="highlight"><pre><span></span><span class="k">use</span> <span class="s">&quot;</span><span class="vg">${repo}</span><span class="s">transplants&quot;</span>,<span class="k"> clear</span> 
<span class="k">merge</span> <span class="m">1</span>:<span class="m">1</span> fake_id <span class="cs">///</span>
    using <span class="s">&quot;</span><span class="vg">${repo}</span><span class="s">donors_recipients&quot;</span>, <span class="cs">///</span>
<span class="k">    keep</span>(match)
</pre></div>
</div>
</section>
<section id="flexible-data-structures-with-reshape">
<h2>6.6 Flexible Data Structures with <code class="docutils literal notranslate"><span class="pre">reshape</span></code><a class="headerlink" href="#flexible-data-structures-with-reshape" title="Permalink to this heading">#</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">reshape</span></code> command allows for switching between wide and long formats, which is particularly useful in longitudinal studies where time-point data may need to be restructured for analysis. See week 3 <a class="reference external" href="https://jhustata.github.io/basic/chapter3.html?highlight=collapse#reshape">Section 3.3</a> for an example</p>
<div class="highlight-stata notranslate"><div class="highlight"><pre><span></span><span class="c1">//help reshape</span>
<span class="k">use</span> <span class="vg">${repo}</span>ctr_yr,<span class="k"> clear</span> 

<span class="c1">//example of reshape wide</span>
<span class="k">reshape</span> wide<span class="k"> n</span>, i(ctr_id) j(yr)
<span class="k">list</span> ctr_id n2007<span class="o">-</span>n2010, clean noobs

<span class="c1">//go back to long</span>
<span class="k">reshape</span> long

<span class="c1">//and again</span>
<span class="k">reshape</span> wide
<span class="k">reshape</span> long
<span class="k">reshape</span> wide

<span class="c1">//change missingness of n2006-n2015 variables to 0</span>
<span class="k">foreach</span> v of<span class="k"> varlist</span> n20<span class="o">*</span> {
<span class="k">    replace</span> <span class="nv">`v&#39;</span> = <span class="m">0</span><span class="k"> if</span> <span class="nf">missing</span>(<span class="nv">`v&#39;</span>)
}

<span class="k">reshape</span> long

<span class="c1">//syntax for reshaping wide to long</span>
<span class="c1">//setup</span>
<span class="k">reshape</span> wide
<span class="k">reshape clear</span>

<span class="k">reshape</span> long<span class="k"> n</span>, i(ctr_id) j(yr)
<span class="k">list</span>, clean noobs
 
</pre></div>
</div>
</section>
<section id="other">
<h2>6.7 Other<a class="headerlink" href="#other" title="Permalink to this heading">#</a></h2>
<p>How would you define “exposure” to a drug in the simulation dataset below? (<strong>Note:</strong> Simulation allows us to learn about real-world data without <a class="reference external" href="https://guides.library.jhu.edu/protecting_identifiers/definitions">discolure risks</a>)</p>
<div class="highlight-stata notranslate"><div class="highlight"><pre><span></span><span class="k">use</span> <span class="vg">${repo}</span>strpos<span class="m">.</span>dta,<span class="k"> clear</span> 
</pre></div>
</div>
<p>“Exposure” to a drug typically refers to whether and how subjects in the dataset have been administered or have taken the drug. This can include various aspects:</p>
<ol class="arabic simple">
<li><p><strong>Binary Exposure</strong>: Whether the subjects were exposed or not to the drug at any point during the study period. This is often coded as a binary variable (e.g., 1 for exposed, 0 for not exposed). Randomized trials are of this nature. Is this simplistic or true to reality?</p></li>
<li><p><strong>Dosage</strong>: The amount of the drug given to the subjects. This could be measured in units like mg, ml, etc., depending on the drug’s administration method. Is it cumulative dosage? Or conditional (e.g. cumulative dosage in the last month?)</p></li>
<li><p><strong>Duration</strong>: How long the subjects have been exposed to the drug. This could be in days, months, or years. And has the compliance been <span class="math notranslate nohighlight">\(100%\)</span> throughout?</p></li>
<li><p><strong>Frequency</strong>: How often the drug was administered during the period of study (e.g., daily, weekly, monthly).</p></li>
<li><p><strong>Mode of Administration</strong>: How the drug was administered (e.g., oral, intravenous, topical).</p></li>
</ol>
<p><strong>Person-time</strong> might become the unit of analysis in such matters if you wish to capture reality as robustly as possible.</p>
<p>In this simulation of large national registry data, these variables described were generated based on real-world distributions from the <a class="reference external" href="https://usrds-adr.niddk.nih.gov/2023">United States Renal Data System</a>to mimic actual patient data without the risk of disclosing personal health information. The <code class="docutils literal notranslate"><span class="pre">strpos.dta</span></code> dataset defines aspects of drug exposure, a very complicated kind of nested data.</p>
<p>How many large national databases have we had some “exposure” to in this class?</p>
<ol class="arabic simple">
<li><p><a class="reference external" href="https://www.srtr.org/about-the-data/the-srtr-database/">SRTR</a></p></li>
<li><p><a class="reference external" href="https://wwwn.cdc.gov/nchs/nhanes/ContinuousNhanes/Default.aspx?BeginYear=1999">NHANES</a></p></li>
<li><p><a class="reference external" href="https://usrds-adr.niddk.nih.gov/2023">USRDS</a></p></li>
</ol>
<p>Those datasets have hierarchical structures in these dimensions:</p>
<ol class="arabic simple">
<li><p>Calendar</p></li>
<li><p>Geography</p></li>
<li><p>Demography</p></li>
<li><p>Phenotype</p></li>
<li><p>Etc.</p></li>
</ol>
</section>
<section id="lab-session">
<h2>6.8 Lab Session<a class="headerlink" href="#lab-session" title="Permalink to this heading">#</a></h2>
<p>Next week’s lab will involve hands-on exercises using datasets to apply the concepts learned about nested and hierarchical data (to be posted before Monday).</p>
</section>
<section id="homework">
<h2>6.9 Homework<a class="headerlink" href="#homework" title="Permalink to this heading">#</a></h2>
<p>Homework will focus on practical applications of <code class="docutils literal notranslate"><span class="pre">merge</span></code>, <code class="docutils literal notranslate"><span class="pre">collapse</span></code>, and <code class="docutils literal notranslate"><span class="pre">reshape</span></code>, challenging you to manipulate and analyze a provided dataset with hierarchical structures.</p>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="chapter5.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">5. Review of Weeks 1 - 4</p>
      </div>
    </a>
    <a class="right-next"
       href="chapter7.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">7. Visualizing data in Stata</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#introduction-to-debugging">Introduction to Debugging</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#revisiting-hardcoding">Revisiting Hardcoding</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#understanding-isid">6.1 Understanding <code class="docutils literal notranslate"><span class="pre">isid</span></code></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#independently-and-identically-distributed-data-i-i-d">Independently and Identically Distributed Data (i.i.d.)</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-concept-of-collapse">6.2 The Concept of <code class="docutils literal notranslate"><span class="pre">collapse</span></code></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#use-of-egen">6.3 Use of <code class="docutils literal notranslate"><span class="pre">egen</span></code></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#data-integrity-with-preserve-and-restore">6.4 Data Integrity with <code class="docutils literal notranslate"><span class="pre">preserve</span></code> and <code class="docutils literal notranslate"><span class="pre">restore</span></code></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#combining-data-with-merge">6.5 Combining Data with <code class="docutils literal notranslate"><span class="pre">merge</span></code></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#flexible-data-structures-with-reshape">6.6 Flexible Data Structures with <code class="docutils literal notranslate"><span class="pre">reshape</span></code></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#other">6.7 Other</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#lab-session">6.8 Lab Session</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#homework">6.9 Homework</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Abimereki Muzaale
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      © Copyright 2024.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>